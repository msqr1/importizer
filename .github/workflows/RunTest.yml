name: Run test

on: push

jobs:
  all:
    strategy:
      matrix:
        platform: [ubuntu-latest, macos-15, windows-latest]
    runs-on: ${{ matrix.platform }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4.2.2
      - name: Build
        id: build
        run: mkdir build && cd build && cmake .. -DBUILD_TESTS=ON && cmake --build .
      - name: Test
        if: steps.build.outcome == 'success'
        id: test
        run: cd ${{ github.workspace }}/build/test && ctest --output-on-failure -C Debug
      - name: Upload built binary
        if: steps.test.outcome == 'success'
        uses: actions/upload-artifact@v4.6.0
        with:
          name: include2import-${{ matrix.platform }}
          path: ${{ github.workspace }}/build/src/include2import*